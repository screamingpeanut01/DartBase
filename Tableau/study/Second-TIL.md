# 4th Study Week 

- 38강: [퀵테이블계산(2)](#38-퀵테이블계산2)

- 39강: [LOD](#39강-lod)

- 40강: [EXCLUDE](#40-lod-exclude)

- 41강: [INCLUDE](#41-lod-include)

- 42강 : [매개변수](#42-매개변수)

- 43강: [매개변수 실습](#44-매개변수-실습-강의-없네)

- 44강: [마크카드](#45-워크시트-마크카드)

- 45강: [서식계층](#46-서식-계층)

- 46강: [워크시트](#47-워크시트-서식)

- [문제1](#문제-1)

- [문제2](#문제-2)

- [문제3](#문제-3)

## Study Schedule

| 강의 범위     | 강의 이수 여부 | 링크                                                                                                        |
|--------------|---------|-----------------------------------------------------------------------------------------------------------|
| 1~9강        |  ✅      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=84)       |
| 10~19강      | ✅      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=75)       |
| 20~29강      | ✅      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=65)       |
| 30~39강      | ✅      | [링크](https://www.youtube.com/watch?v=e6J0Ljd6h44&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=55)       |
| 40~49강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=45)       |
| 50~59강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=35)       |
| 60~69강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=25)       |
| 70~79강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=15)       |
| 80~89강      | 🍽️      | [링크](https://www.youtube.com/watch?v=AXkaUrJs-Ko&list=PL87tgIIryGsa5vdz6MsaOEF8PK-YqK3fz&index=5)        |


## 38. 퀵테이블계산(2)

> 이동평균

![표시되었으면 하는 이름](../study/

이전 두 분기와 현재 분기의 분기별 평균 표현 중
1, 2, 3분기의 매출 합계의 평균이 이동 평균 그래프의 3분기 이동 평균의 합으로 표시됨.

> YTD 총계(Year to Date)

특정 시점을 기준으로 해당 연도부터 그 시점까지의 총계

하위 레벨인 분기, 월 등이 존재해야 사용할 수 있음.

> 전년 대비 성장률
같은 월을 기준으로 이전 연도 대비 얼마나 성장했는지 확인

> YTD 성장률
단일 계산식이 아니기 때문에 에러가 발생함(?)
-> 데이터 패널로 계산된 필드로 만들면
성장률 안에 총계가 숨어있어 이중으로 계산을 진행하는 꼴이 됨.



## 39강. LOD

LOD: Level of Detail
뷰에 세부 수준을 나타냄

현재 뷰에는 영향을 받지 않고 원하는 세부 수준 계산 수행 가능
계산할 수준을 세부적으로 제어 가능하도록 함

```
필터를 전체에 적용하고 싶지는 않지만, 계산해서 변수로 담아 사용하고자 하는 경우 사용 가능

INCLUDE 
EXCLUDE
FIXED
```

FIXED 현재 뷰의 차원과 상관 없이 계산된 필드에서 원하는 차원에 따라

1. Fixed에서 설정한 차원이 뷰에 포함되어 있는 경우

지금은 각 지역의 국가별 매출이 나타나는데, 각 지역별 매출을 나타내는 계산된 필드를 나타내는 경우

```
{ FIXED [지역], [분류]: SUM([매출]) }
```

여러 수준에서 정의하는 경우 콤마(,)로 구분하여 나열
: 측정하고자 하는 측정값을 ':' 뒤에 배치

-> 계산된 필드를 더블클릭하여 측정값으로 배치



2. FIXED에서 설정한 차원이 뷰에 포함되어 있지 않을 때


> ✅ FIXED가 용이하게 쓰일 수 있는 경우

뷰에는 포함되지 않는 하위 범주들에 대해 계산 시 해당 하위 범주들을 포함해 계산하는 경우

Q. 필터는 어떻게 표현될까?

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오전%203.29.18.png)

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오전%203.29.31.png)

필터는 항목을 제외하는 경우, 남은 데이터들의 구성 비율을 다시 계산하기 때문에 값이 고정적이지 않음.

```
{ FIXED : SUM([매출]) }
```

LOD 표현식에서 차원을 입력하지 않는 경우 전체 데이터 기준에 따라 계산함

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오전%203.34.50.png)

전체 매출을 미리 계산해두고, 그 전체를 기준으로 매출의 비율을 계산하면 필터가 적용되어도 변하지 않는 구성 비율이 됨.


## 40. LOD EXCLUDE

> EXCLUDE LOD

현재 뷰에서 특정 차원을 제외하여 계산할 때 사용

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오전%203.49.05.png) 

범주 차원으로 계산했기 때문에 총계는 범주를 기준으로 매겨지고 있음

(아래로 계산, 옆으로 계산 ... 패널 당 계산 ... 없이 바로 총계 계산의 기준으로 적용됨)
 

> FIXED와 EXCLUDE의 차이

✅ 보다 하위 범주로 세분화한 경우

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오전%203.51.01.png)

FIXED는 계산했던 필드를 기준으로 고정되지만, EXCLUDE는 유동적으로 변한다.

하위 범주 차원을 무시하고 매출의 합계를 표시하긴 하지만 현재 뷰의 제조업체 차원이 하위 범주보다 세부수준이 더 낮아 제조업체 기준으로 관련 매출을 표시함.

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오전%203.54.50.png)

필터를 걸었을 때 FIXED는 고정

FIXED는 현재 뷰와 상관없이 특정 차원을 이용해 계산하기에 필터의 영향을 받지 않지만, EXCLUDE는 뷰에 있는 차원을 따라 계산되기 때문에 필터로 걸으면 영향을 받음

```
IF [하위범주] = '액세서리' THEN [매출] END
```

액세서리 매출을 계산하는 필드

```
{ EXCLUDE [하위 범주] : SUM([액세서리 매출]) }
```

```
SUM([매출]) - ATTR([Exclude 하위 범주 매출])
```


**🧞‍♀️ 왜 ATTR 함수를 사용하나요?**


Tableau에서 ATTR 함수는 주로 특정 필드가 단일 값을 가지는지 확인하거나, 필드가 여러 값을 가지는 상황에서 단일 값을 반환하려는 경우에 사용됩니다.

ATTR 함수의 역할
단일 값 보장: ATTR([Exclude 하위 범주 매출])는 [Exclude 하위 범주 매출] 필드의 값이 단일 값일 때 그 값을 반환하고, 만약 여러 다른 값이 있을 경우 *를 반환합니다.

집계 함수와의 호환성: ATTR는 집계 함수와 호환되며, 집계된 데이터에서 단일 값을 처리할 때 유용합니다.

오류 방지: 만약 [Exclude 하위 범주 매출]가 데이터 원본의 여러 레코드에서 다양한 값을 가진다면, 이를 SUM 같은 집계 함수와 함께 사용할 때 오류가 발생할 수 있습니다. ATTR를 사용하면 이러한 문제를 피할 수 있습니다.

예제
단일 값의 경우: 만약 [Exclude 하위 범주 매출]이 항상 같은 값을 가진다면, ATTR([Exclude 하위 범주 매출])는 그 단일 값을 반환합니다.

여러 값의 경우: 만약 [Exclude 하위 범주 매출]가 여러 값으로 이루어진다면, ATTR([Exclude 하위 범주 매출])는 *를 반환하고 이는 해당 필드에 여러 값이 있음을 나타냅니다.

실용적인 이유
일관된 집계: 수식을 사용할 때 [Exclude 하위 범주 매출]의 값이 단일 값으로 일관되기를 기대할 때, ATTR를 사용하면 데이터가 예상과 일치하는지 확인할 수 있습니다.
에러 방지: 데이터가 여러 값으로 나뉘어 있을 경우 에러를 방지하고, 의도한 대로 계산을 진행할 수 있도록 도와줍니다.


## 41. LOD INCLUDE

현재 뷰에서 특정 차원을 추가하여 계산

총계를 분석 기능을 이용해 계산할 수 있지만, 따로 필드를 생성한 게 아니기 때문에 값을 재사용할 수 없음.

```
AVG( {INCLUDE [주문 ID] : SUM([매출])})
```

주문 ID 차원을 포함하여 합계한 매출에 평균을 반환함

-> 각 도시의 고객당 평균 매출
현재 뷰에서 표시하지 않지만 차원을 계산에 추가할 수 있음

여러 다른 LOD 방법을 통해 같은 결과를 만들 수도 있음

AVG ( { FIXED [주문ID] : SUM([매출])})

**🧞‍♀️ 그렇다면 어떤 경우에 어떤 표현식을 사용하나요?**

> FIXED ONLY: 뷰에 표시되는 값이 차원일 시
차원, 측정값 모두 가능
(차원 필터에 영향을 받지 않음)

> INCLUDE, EXCLUDE: 반환 값이 차원 필터에 영향을 받게끔 만들고 싶은 경우

## 42. 매개변수

고정된 상수값이 아닌 동적인 값으로 표현하기 위해 사용

**계산식, 필터, 참조선**과 함께 사용될 것

**🧞‍♀️ 어떻게 매개변수를 만들 수 있나요?**

1. 필터 값을 입력하는 공간에서 드롭다운 메뉴에 '새 매개변수 만들기' 선택

2. 원하는 필드 만들기 -> 매개변수

3. 데이터 패널 -> 매개변수 만들기

필터 -> 상위 -> 기준 값을 매개변수로 설정할 것

**집합에의 적용
집합 -> 상위 -> 필드 기준 -> 상위 제품 범주**

## 44. 매개변수 실습 (강의 없네)

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오후%2010.40.24.png)

매개변수를 데이터 분석 패널의 참조선으로 설정할 수도 있다.

이때! 매개변수에 도달하지 못한 값들과 도달한 값을 비교하는 아주 유용한 방법이 있다~

```
IF SUM([매출]) >= [목표 매출]
THEN '목표 달성'
ELSE '목표 미달성'
END
```

-> 값을 매개 변수에 담아 비교함

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-12%20오후%2010.49.27.png)

참조선 편집 화면에서 구간 설정도 가능

날짜 범위 매출 합계
TOTAL(SUM(IF [주문 날짜] >= [시작 날짜] AND [주문 날짜] <= [마지막 날짜]) THEN [매출] END)

=> 매개변수를 타이틀에도 추가할 수 있음.

## 45. 워크시트 마크카드

디자인을 직관적으로 표현할 것!

마크의 서식을 변경하기 위해 '마크카드'를 활용
(페이지, 필터, 마크 중)

다른 마크와 겹치는 경우 자동 숨김처리하는데, 레이블이 다른 마크와 겹치도록 허용을 누르면 모두 표시됨


## 46. 서식 계층

More General -> More Specific
워크 시트 서식 - 행/열 서식 - 특정 필드 - 필드 레이블 - 도구설명/제목/마크

**이전 서식을 모두 지우고 싶은 경우 - 워크시트 서식 지우기**

## 47. 워크시트 서식

글꼴, 맞춤, 음영, 테두리, 라인



**누계, 차이, 비율 차이, 구성 비율, 순위, 백분위수, 이동 평균, YTD 총계, 통합 성장률, 전년 대비 성장률, YTD 성장률**

## 문제 리스트

### 문제 1.

다음은 Tableau의 다양한 계산을 사용할 수 있는 경우를 빈칸으로 두고 문제를 작성한 것입니다. 각 빈칸에 적합한 계산 유형을 채워보세요.

| 계산 유형               | 설명                                                                 | 사용 예시                                                                                          |
|-------------------------|----------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| ____________            | 데이터의 누적 합계를 계산                                             | 한 기업이 월별 매출 데이터를 누적하여 연간 매출 추이를 보고 싶을 때 사용                                      |
| ____________            | 연속 데이터 포인트 간의 차이를 계산                                    | 한 기업이 월별 매출 데이터에서 전월 대비 매출 증감량을 분석하고 싶은 경우                                        |
| ____________            | 연속 데이터 포인트 간의 비율 변화를 계산                               | 한 기업이 월별 매출 데이터에서 전월 대비 매출 증감률(%)을 분석하고 싶은 경우                                      |
| ____________            | 전체에서 각 데이터 포인트의 비율을 계산                                | 한 기업이 전체 매출에서 각 제품군이 차지하는 비율을 보고 싶을 때 사용                                           |
| ____________            | 데이터의 순위를 매깁니다                                              | 한 기업이 제품별 매출 데이터를 순위별로 정렬하여 상위 10개 제품을 분석하고 싶은 경우                              |
| ____________            | 데이터의 백분위를 계산                                               | 한 기업이 고객별 구매 금액 데이터를 백분위수로 나누어 상위 25% 고객을 분석하고 싶은 경우                          |
| ____________            | 일정 기간의 평균을 계산                                               | 한 기업이 주간 매출 데이터에서 4주 이동 평균을 계산하여 트렌드를 분석하고 싶은 경우                              |
| ____________            | 연초부터 현재까지의 총계를 계산                                      | 한 기업이 월별 매출 데이터를 연초부터 현재까지 누적하여 연간 매출 목표 달성 여부를 분석하고 싶은 경우             |
| ____________            | 일정 기간 동안의 연평균 성장률을 계산                                  | 한 기업이 5년 간 매출 데이터를 바탕으로 연평균 성장률(CAGR)을 계산하고 싶은 경우                                  |
| ____________            | 전년 동기간 대비 성장률을 계산                                        | 한 기업이 월별 매출 데이터에서 전년 동월 대비 매출 성장률을 분석하고 싶은 경우                                    |
| ____________            | 연초부터 현재까지의 성장률을 계산                                     | 한 기업이 올해 연초부터 현재까지의 매출이 전년 동기 대비 얼마나 성장했는지 분석하고 싶은 경우                     |


### 문제 1의 답.

| 계산 유형               | 설명                                                                 | 사용 예시                                                                                          |
|-------------------------|----------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| 누계 (Running Total)    | 데이터의 누적 합계를 계산                                             | 월별 매출 데이터를 누적하여 연간 매출 추이를 시각화할 때 사용                                      |
| 차이 (Difference)       | 연속 데이터 포인트 간의 차이를 계산                                    | 월별 매출 데이터에서 전월 대비 매출 증감량을 분석할 때 사용                                        |
| 비율 차이 (Percent Difference) | 연속 데이터 포인트 간의 비율 변화를 계산                        | 월별 매출 데이터에서 전월 대비 매출 증감률(%)을 분석할 때 사용                                      |
| 구성 비율 (Percent of Total)   | 전체에서 각 데이터 포인트의 비율을 계산                        | 전체 매출에서 각 제품군이 차지하는 비율을 분석할 때 사용                                           |
| 순위 (Rank)             | 데이터의 순위를 매깁니다                                              | 제품별 매출 데이터를 순위별로 정렬하여 상위 10개 제품을 분석할 때 사용                              |
| 백분위수 (Percentile)   | 데이터의 백분위를 계산                                               | 고객별 구매 금액 데이터를 백분위수로 나누어 상위 25% 고객을 분석할 때 사용                          |
| 이동 평균 (Moving Average) | 일정 기간의 평균을 계산                                           | 주간 매출 데이터에서 4주 이동 평균을 계산하여 트렌드를 분석할 때 사용                              |
| YTD 총계 (YTD Total)    | 연초부터 현재까지의 총계를 계산                                      | 월별 매출 데이터를 연초부터 현재까지 누적하여 연간 매출 목표 달성 여부를 분석할 때 사용             |
| 통합 성장률 (Compound Growth Rate) | 일정 기간 동안의 연평균 성장률을 계산                        | 5년 간 매출 데이터를 바탕으로 연평균 성장률(CAGR)을 계산할 때 사용                                  |
| 전년 대비 성장률 (Year-over-Year Growth) | 전년 동기간 대비 성장률을 계산                        | 월별 매출 데이터에서 전년 동월 대비 매출 성장률을 분석할 때 사용                                    |
| YTD 성장률 (YTD Growth) | 연초부터 현재까지의 성장률을 계산                                     | 올해 연초부터 현재까지의 매출이 전년 동기 대비 얼마나 성장했는지 분석할 때 사용                     |


## 문제 2.

```
가장 많이 주문한 사람들은 물건 배송을 빨리 받았을까요?
조건을 준수하여 아래 이미지를 만들어봆시다.
1) 국가/지역별(이하 '나라'로 통칭), 범주별로 배송에 걸리는 날짜 일수가 다를 수 있으니 먼저, 나라별/범주별로 평균 배송까지 걸리는 일수를 설정한 뒤,
2) 각 나라에서 가장 많이 주문한 사람의 이름을 첫 번째 열,
3) 그 사람이 주문한 제품 이름을 2번째 열,
4) 각 상품이 배송까지 걸린 날 수를 표현하고
5) 그리고 만약 배송이 각 나라/범주별 평균보다 빨랐다면 '빠름', 같다면 '평균', 느리다면 '느림' 으로 print 해주세요. 
```

![스크린샷](../study/img/2nd%20study/스크린샷%202024-08-13%20오전%2010.12.36.png)

<!-- 여기까지 오는 과정 중 알게 된 점을 기입하고, 결과는 시트 명을 본인 이름으로 바꾸어 표시해주세요.-->

## 문제 2 - 풀이


1. 먼저 배송에 걸리는 일자에 대한 계산된 필드를 제작합니다.
![필드](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%204.14.26.png)

DATEDIFF라는 함수가 인수로 무엇을 받는지를 확인해보세요.

데이터타입이 날짜이므로 무작정 빼는 것이 아니라 DATEDIFF를 사용하는 것이 적합합니다.

![필드](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%204.17.18.png)

계산된 필드를 작성한 후에는 꼭 내가 원하는대로 나왔는지를 판단해보세요.

그리고 아직은 집계값이 아니라, row별로 각각 존재해야 하는 값이므로 별도의 계산식이 없어야 합니다.

2. 나라별/범주별로 평균적으로 배송에 평균적으로 걸리는 날짜를 계산해볼게요.

이건 필터에 따라 바뀌지 않았으면 하는 지표로 이해하고, 모든 데이터를 사용하여 산출해야 합니다.

![배송](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%204.20.14.png)

![범주](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%206.51.06.png)

국가보다 더 낮은 시/도로 표현했을 때 Average가 다 같은 걸 보니, 국가/지역 별로 잘 집계된 것으로 보입니다.

그리고 국가에서 가장 많이 주문한 사람을 골라내보겠습니다.

국가별/ID별 가장 많은 주문량을 필드에 담아두겠습니다.

![국가](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%206.55.48.png)

실수입니다. COUNT로 집계할 경우 NULL값이 포함되어 NULL이 최상위가 될 수 있습니다.

**따라서 NULL값을 포함하지 않고 COUNT하는 COUNTD 함수를 사용해야 합니다**

![집계](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%206.59.27.png)

> COUNT와 COUNTD는 SQL과 비슷한 데이터 처리 언어에서 사용되는 집계 함수로, 두 함수 모두 집합의 요소를 세는 데 사용되지만 그 방식에 차이가 있습니다.

COUNT
설명: COUNT는 지정된 열에서 NULL 값을 제외한 모든 행의 수를 셉니다.
사용 예시: COUNT(column_name)
결과: 열의 값이 중복되더라도 전체 행 수를 반환합니다.
예시:
데이터: A, B, B, C, NULL
쿼리: SELECT COUNT(column_name) FROM table
결과: 4 (NULL 제외, 중복 포함)
COUNTD (또는 COUNT DISTINCT)
설명: COUNTD는 지정된 열에서 NULL 값을 제외한 고유한 값의 수를 셉니다. 

![계산](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%206.59.49.png)

이렇게 국가별 최고 주문 횟수의 고객이 나왔습니다.

![2](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%207.00.48.png)

![2](../study/img/2nd%20study/스크린샷%202024-08-13%20오후%207.03.30.png)

그들이 주문한 제품과 배송 속도 수준을 이렇게 올려주면 끝입니다.

## 문제 3.

```
채원이는 태블로를 쓰실 수 없는 상사분께 보고하기 위한 대시보드를 만들고 싶어요. 

제품 중분류별로 구분하되 매개변수로써 수익, 매출, 수량을 입력하면 저절로 각각 지표에 해당하는 그래프로 바뀌도록 설계하고자 해요.

 어떤 값이 각 지표의 평균보다 낮은 값을 갖고 있다면 색깔을 주황색으로, 그것보다 높다면 파란색으로 표시하고 싶어요. 그 평균값은 각 지표별로 달라야 해요.
```

![예시이미지](../study/img/2nd%20study/다운로드.png)
