# Week3

# SQL_ADVANCED 3ì£¼ì°¨ ì •ê·œ ê³¼ì œ

## Week 3: ìœˆë„ìš° í•¨ìˆ˜ (Window Functions)

ðŸ“Œ**SQL_ADVANCED ì •ê·œê³¼ì œ**ëŠ” ë§¤ì£¼ ì •í•´ì§„ ì£¼ì œì— ë”°ë¼ **MySQL ê³µì‹ ë¬¸ì„œ ë˜ëŠ” í•œê¸€ ë¸”ë¡œê·¸ ìžë£Œë¥¼ ì°¸ê³ í•´ ê°œë…ì„ ì •ë¦¬í•œ í›„, ì´ë²ˆ ì£¼ì°¨ì—ëŠ” LeetCode SQL ë¬¸ì œ 3ë¬¸ì œ**ì™€ **ì¶”ê°€ í™•ì¸ë¬¸ì œ**ë¥¼ ì§ì ‘ í’€ì–´ë³´ë©° í•™ìŠµí•˜ëŠ” ê³¼ì œìž…ë‹ˆë‹¤.

ì´ë²ˆ ì£¼ëŠ” ì•„ëž˜ì˜ **SQL_ADVANCED_3rd_TIL**ì— ë‚˜ì—´ëœ ì£¼ì œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë…ì„ í•™ìŠµí•˜ê³ , ì£¼ì°¨ë³„ **í•™ìŠµ ëª©í‘œ**ì— ë§žê²Œ ì •ë¦¬í•´ì£¼ì„¸ìš”. ì •ë¦¬í•œ ë‚´ìš©ì€ GitHubì— ì—…ë¡œë“œí•œ í›„, **ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ 'SQL' ì‹œíŠ¸ì— ë§í¬ë¥¼ ì œì¶œ**í•´ì£¼ì„¸ìš”.

**(ìˆ˜í–‰ ì¸ì¦ìƒ·ì€ í•„ìˆ˜ìž…ë‹ˆë‹¤.)**

> Leet codeì˜ ë¬¸ì œë¥¼ í’€ê³  'ì •ë‹µìž…ë‹ˆë‹¤' ë¬¸êµ¬ë¥¼ ìº¡ì³í•´ì„œ ì˜¬ë ¤ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.
> 

## SQL_ADVANCED_3rd

### 14.20.2 Window Function Concepts and Syntax

### 14.20.1 Window Function Description

### 14.19.1 Aggregate Function Descriptions

- ìœ„ ë¬¸ì„œ ì¤‘ *14.19.1. Aggregate Function Descriptions* ë¬¸ì„œì—ì„œ 1ì£¼ì°¨ (ì§‘ê³„ í•¨ìˆ˜) ì—ì„œ ë‹¤ë£¬ ë¶€ë¶„ì„ ì œì™¸í•˜ê³  **OVER( ) ì ˆì„ í™œìš©í•œ ìœˆë„ìš° í•¨ìˆ˜ ë¬¸ë²•ê³¼ `RANK( ), DENSE_RANK( ), ROW_NUMBER( ), LAG( ), LEAD( )`ë“± ìœˆë„ìš° í•¨ìˆ˜ íŠ¹ìœ ì˜ ê¸°ëŠ¥ ì¤‘ì‹¬ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ì„¸ìš”.**

## ðŸ ê°•ì˜ ìˆ˜ê°• (Study Schedule)

| ì£¼ì°¨ | ê³µë¶€ ë²”ìœ„ | ì™„ë£Œ ì—¬ë¶€ |
| --- | --- | --- |
| 1ì£¼ì°¨ | ì„œë¸Œì¿¼ë¦¬ & CTE | âœ… |
| 2ì£¼ì°¨ | ì§‘í•© ì—°ì‚°ìž & ê·¸ë£¹ í•¨ìˆ˜ | âœ… |
| 3ì£¼ì°¨ | ìœˆë„ìš° í•¨ìˆ˜ | âœ… |
| 4ì£¼ì°¨ | Top N ì¿¼ë¦¬ | ðŸ½ï¸ |
| 5ì£¼ì°¨ | ê³„ì¸µí˜• ì§ˆì˜ì™€ ì…€í”„ ì¡°ì¸ | ðŸ½ï¸ |
| 6ì£¼ì°¨ | PIVOT / UNPIVOT | ðŸ½ï¸ |
| 7ì£¼ì°¨ | ì •ê·œ í‘œí˜„ì‹ | ðŸ½ï¸ |

### ê³µì‹ ë¬¸ì„œ í™œìš© íŒ

> MySQL ê³µì‹ ë¬¸ì„œëŠ” ì˜ì–´ë¡œ ì œê³µë˜ì§€ë§Œ, í¬ë¡¬ ë¸Œë¼ìš°ì €ì—ì„œ ê³µì‹ ë¬¸ì„œë¥¼ ì—´ê³  ì´ íŽ˜ì´ì§€ ë²ˆì—­í•˜ê¸°ì—ì„œ í•œêµ­ì–´ë¥¼ ì„ íƒí•˜ë©´ ë²ˆì—­ëœ ë²„ì „ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ë²ˆì—­ë³¸ì€ ë¬¸ë§¥ì´ ì–´ìƒ‰í•œ ë¶€ë¶„ì´ ì¢…ì¢… ìžˆìœ¼ë‹ˆ ì˜ì–´ ì›ë¬¸ê³¼ í•œêµ­ì–´ ë²ˆì—­ë³¸ì„ ì™”ë‹¤ ê°”ë‹¤ í•˜ë©° í™•ì¸í•˜ê±°ë‚˜, êµìœ¡íŒ€ìž¥ì˜ ì •ë¦¬ ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ì…”ë„ ê´œì°®ìŠµë‹ˆë‹¤.
> 

# 1ï¸âƒ£ í•™ìŠµ ë‚´ìš©

> ì•„ëž˜ì˜ ë§í¬ë¥¼ í†µí•´ MySQL ê³µì‹ë¬¸ì„œë¡œ ì´ë™í•˜ì‹¤ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
> 
> - 14.20.2 Window Function Concepts and Syntax : MySQL ê³µì‹ë¬¸ì„œ
> 
> [https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html](https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html)
> 
> (í•œêµ­ì–´ ë²„ì „) [https://dart-b-official.github.io/posts/mysql-Window-Function/](https://dart-b-official.github.io/posts/mysql-Window-Function/)
> 
> - 14.20.1 Window Function Description : MySQL ê³µì‹ë¬¸ì„œ
> 
> [https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html](https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html)
> 
> (í•œêµ­ì–´ ë²„ì „) [https://dart-b-official.github.io/posts/mysql-Window-Function(2)/](https://dart-b-official.github.io/posts/mysql-Window-Function(2)/)
> 
> - 14.19.1 Aggregate Function Descriptions : MySQL ê³µì‹ë¬¸ì„œ
> 
> [https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html)
> 
> (í•œêµ­ì–´ ë²„ì „) [https://dart-b-official.github.io/posts/mysql-aggregate_function/](https://dart-b-official.github.io/posts/mysql-aggregate_function/)
> 

<br>

---

# 2ï¸âƒ£ í•™ìŠµ ë‚´ìš© ì •ë¦¬í•˜ê¸°

## WINDOW FUC

 ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë‚´ì—ì„œ í–‰ ë‹¨ìœ„ì˜ ë³µìž¡í•œ ë¶„ì„ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê°•ë ¥í•œ ë„êµ¬

ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì§‘ê³„ í•¨ìˆ˜ì²˜ëŸ¼ ì—¬ëŸ¬ í–‰ì„ ê·¸ë£¹í™”í•˜ì—¬ í•˜ë‚˜ì˜ ê²°ê³¼ë¡œ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ê° í–‰ì— ëŒ€í•´ ê°œë³„ì ì¸ ê³„ì‚° ê²°ê³¼ë¥¼ ë°˜í™˜í• 

ìœˆë„ìš° í•¨ìˆ˜ëŠ” `OVER` ì ˆê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ ë¶„ì„ì˜ ëŒ€ìƒì´ ë˜ëŠ” í–‰ì˜ ì§‘í•©, ì¦‰ 'ìœˆë„ìš°'ë¥¼ ì •ì˜

### **OVER ì ˆì„ í†µí•œ ìœˆë„ìš° í•¨ìˆ˜ì˜ êµ¬ì¡°**

ìœˆë„ìš° í•¨ìˆ˜ëŠ” `OVER` ì ˆì„ í†µí•´ ì–´ë–¤ í–‰ë“¤ì„ ê³„ì‚°ì— í¬í•¨í• ì§€ ê²°ì •

 `OVER` ì ˆì€ ë‹¤ìŒê³¼ ê°™ì€ ì„¸ ê°€ì§€ ì£¼ìš”ìš”ì†Œë¡œ êµ¬ì„±

- **`PARTITION BY`**: ì „ì²´ ë°ì´í„° ì§‘í•©ì„ íŠ¹ì • ì—´ì˜ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ìž‘ì€ ê·¸ë£¹(íŒŒí‹°ì…˜)ìœ¼ë¡œ ë¶„í• 
- **`ORDER BY`**: ê° íŒŒí‹°ì…˜ ë‚´ì—ì„œ í–‰ì˜ ìˆœì„œë¥¼ ì •ë ¬. ì´ëŠ” ìˆœìœ„ë‚˜ ëˆ„ì  í•©ê³„ë¥¼ ê³„ì‚°í•  ë•Œ í•„ìˆ˜ì ì´ë©°, ì–´ë–¤ ìˆœì„œë¡œ ê³„ì‚°ì„ ìˆ˜í–‰í• ì§€ ê²°ì •
- **`frame_clause` (ROWS/RANGE)**: íŒŒí‹°ì…˜ ë‚´ì—ì„œ í˜„ìž¬ í–‰ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ì— í¬í•¨ë  í–‰ì˜ ë²”ìœ„ë¥¼ ë” ì„¸ë¶€ì ìœ¼ë¡œ ì§€ì •

ì´ëŸ¬í•œ êµ¬ì¡°ë¥¼ í†µí•´ ìœˆë„ìš° í•¨ìˆ˜ëŠ” `SELECT` ë¬¸ê³¼ `ORDER BY` ì ˆì—ì„œ ì‚¬ìš©ë˜ì–´, `FROM`, `WHERE`, `GROUP BY`, `HAVING` ì ˆì´ ì²˜ë¦¬ëœ ì´í›„ì— ê° í–‰ì— ëŒ€í•œ ë¶„ì„ì„ ìˆ˜í–‰

### **RANK, DENSE_RANK, ROW_NUMBERì˜ ì°¨ì´**

`RANK`, `DENSE_RANK`, `ROW_NUMBER`ëŠ” ëª¨ë‘ ìˆœìœ„ë¥¼ ë§¤ê¸°ëŠ” ìœˆë„ìš° í•¨ìˆ˜ì´ì§€ë§Œ, ë™ì (ë™ì¼í•œ ê°’)ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì—  ì°¨ì´

- **`ROW_NUBER()`**: íŒŒí‹°ì…˜ ë‚´ì—ì„œ ê° í–‰ì— **ê³ ìœ í•œ ìˆœë²ˆ**ì„ ë¶€ì—¬. ë™ì ì¸ í–‰ì´ ìžˆë”ë¼ë„ ì„œë¡œ ë‹¤ë¥¸ ìˆœë²ˆì„ í• ë‹¹
- **`RANK()`**: ë™ì ì¸ í–‰ì—ëŠ” **ê°™ì€ ìˆœìœ„**ë¥¼ ë¶€ì—¬í•˜ì§€ë§Œ, ë‹¤ìŒ ìˆœìœ„ëŠ” ë™ì ì¸ í–‰ì˜ ìˆ˜ë§Œí¼ ê±´ë„ˆë›°ì–´ ê³„ì‚°
- **`DENSE_RANK()`**: `RANK()`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë™ì ì¸ í–‰ì— **ê°™ì€ ìˆœìœ„**ë¥¼ ë¶€ì—¬í•˜ì§€ë§Œ, ìˆœìœ„ë¥¼ ê±´ë„ˆë›°ì§€ ì•Šê³  **ì—°ì†ì ìœ¼ë¡œ** ë¶€ì—¬

| í•¨ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ (ì ìˆ˜: 100, 90, 90, 80) |
| --- | --- | --- |
| **`ROW_NUMBER()`** | ê³ ìœ í•œ ìˆœë²ˆ ë¶€ì—¬ | 1, 2, 3, 4 |
| **`RANK()`** | ë™ì  ìˆœìœ„ ë¶€ì—¬ (ìˆœìœ„ ê±´ë„ˆë›°ê¸°) | 1, 2, 2, 4 |
| **`DENSE_RANK()`** | ë™ì  ìˆœìœ„ ë¶€ì—¬ (ì—°ì† ìˆœìœ„) | 1, 2, 2, 3 |

### **LAGì™€ LEAD í•¨ì˜ í™œìš©**

`LAG`ì™€ `LEAD` í•¨ìˆ˜ëŠ” í˜„ìž¬ í–‰ì„ ê¸°ì¤€ìœ¼ë¡œ íŒŒí‹°ì…˜ ë‚´ì˜ **ì´ì „ ë˜ëŠ” ì´í›„ í–‰ì˜ ê°’**ì„ ê°€ì ¸ì˜¬ ë•Œ ì‚¬ìš©

- **`LAG(expression, offset, default)`**: í˜„ìž¬ í–‰ë³´ë‹¤ `offset`ë§Œí¼ **ì•žì— ìžˆëŠ” í–‰**ì˜ `expression` ê°’ì„ ë°˜í™˜. `offset`ì˜ ê¸°ë³¸ê°’ì€ 1ì´ë©°, í•´ë‹¹ í–‰ì´ ì—†ì„ ê²½ìš° `default` ê°’ì´ ë°˜í™˜. ì£¼ë¡œ ì´ì „ ê¸°ê°„ê³¼ì˜ ë°ì´í„° ë¹„êµì— ì‚¬ìš©
- **`LEAD(expression, offset, default)`**: í˜„ìž¬ í–‰ë³´ë‹¤ `offset`ë§Œí¼ **ë’¤ì— ìžˆëŠ” í–‰**ì˜ `expression` ê°’ì„ ë°˜í™˜. `LAG`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ `offset`ê³¼ `default` ê°’ì„ ì§€ì •í•  ìˆ˜ ìžˆìœ¼ë©°, ì´í›„ ê¸°ê°„ê³¼ì˜ ë°ì´í„° ë¹„êµì— í™œìš©

---

# 3ï¸âƒ£ ì‹¤ìŠµ ë¬¸ì œ

## LeetCode ë¬¸ì œ

[https://leetcode.com/problems/department-top-three-salaries/](https://leetcode.com/problems/department-top-three-salaries/)

> LeetCode 185. Department Top Three Salaries
> 
> 
> í•™ìŠµ í¬ì¸íŠ¸ : DENSE_RANK( ) + PARTITION BY ì‚¬ìš©ìœ¼ë¡œ ê·¸ë£¹ ë‚´ ìƒìœ„ Nê°œ ì¶”ì¶œ
> 

[https://leetcode.com/problems/consecutive-numbers/](https://leetcode.com/problems/consecutive-numbers/)

> LeetCode 180. Consecutive Numbers
> 
> 
> í•™ìŠµ í¬ì¸íŠ¸ : LAG( ) í•¨ìˆ˜ë¡œ ì´ì „ ê°’ê³¼ ë¹„êµí•˜ì—¬ ì—°ì† ë°ì´í„° íƒì§€
> 

[https://leetcode.com/problems/last-person-to-fit-in-the-bus/](https://leetcode.com/problems/last-person-to-fit-in-the-bus/)

> LeetCode 2481. Last Person to Fit in the Bus
> 
> 
> í•™ìŠµ í¬ì¸íŠ¸ : SUM( ) OVER (ORDER BY ...) ë¡œ ëˆ„ì  í•©ê³„ ê³„ì‚° í›„ ì¡°ê±´ í•„í„°ë§
> 

---

## ë¬¸ì œ ì¸ì¦ëž€

![image.png](image.png)

![image.png](image%201.png)

![image.png](image%202.png)

---

# í™•ì¸ë¬¸ì œ

## ë¬¸ì œ 1

> ðŸ§šì˜ˆë¦°ì´ëŠ” ê³ ê°ë³„ë¡œ ì–¼ë§ˆë‚˜ ë§Žì€ ì£¼ë¬¸ì„ í•˜ëŠ”ì§€ ë¶„ì„í•˜ê¸° ìœ„í•´, ê³ ê°ì˜ ì£¼ë¬¸ ëª©ë¡ì— ì£¼ë¬¸ ìˆœì„œë¥¼ í‘œì‹œí•˜ëŠ” ì¿¼ë¦¬ë¥¼ ìž‘ì„±í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ë•Œ ì£¼ë¬¸ì¼ ìˆœì„œëŒ€ë¡œ ê° ê³ ê°ì˜ ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ ë§¤ê¸°ê¸° ìœ„í•´ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš©í–ˆìŠµë‹ˆë‹¤.
> 

```sql
SELECT customer_id, order_id, order_date,
       ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date) AS order_rank
FROM Orders;

```

> ì´ë²ˆì—ëŠ” ì˜ˆë¦°ì´ì—ê²Œ "ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì“°ì§€ ì•Šê³  ë™ì¼í•œ ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ë³´ë¼"ëŠ” ë¯¸ì…˜ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. ì˜ˆë¦°ì´ëŠ” ì´ ìž‘ì—…ì„ ì–´ë–»ê²Œ í•´ì•¼í• ì§€ ë§‰ë§‰í•©ë‹ˆë‹¤. ì˜ˆë¦°ì´ë¥¼ ë„ì™€ ROW_NUMBER() ìœˆë„ìš° í•¨ìˆ˜ ì—†ì´ ë™ì¼í•œ ê²°ê³¼ë¥¼ ì„œë¸Œì¿¼ë¦¬ë‚˜ JOINì„ ì‚¬ìš©í•´ì„œ ìž‘ì„±í•´ë³´ì„¸ìš”.
> 

```sql
SELECT
    o1.customer_id,
    o1.order_id,
    o1.order_date,
    (
        SELECT COUNT(*)
        FROM Orders o2
        WHERE o2.customer_id = o1.customer_id
          AND o2.order_date <= o1.order_date
    ) AS order_rank
FROM
    Orders o1
ORDER BY
    o1.customer_id,
    o1.order_date;
```

### ðŸŽ‰ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.